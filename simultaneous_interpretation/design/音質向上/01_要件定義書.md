# 要件定義書 - 音質向上プロジェクト

**文書番号**: REQ-2025-001  
**作成日**: 2025-10-26  
**最終更新**: 2025-10-26  
**ステータス**: ✅ 承認済み  
**バージョン**: 1.0

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [基本方針](#基本方針)
3. [機能要件](#機能要件)
4. [非機能要件](#非機能要件)
5. [制約事項](#制約事項)
6. [成功基準](#成功基準)

---

## 1. プロジェクト概要

### 1.1 背景

VoiceTranslate Pro の現状：
- 翻訳精度: 85-90% (目標未達)
- 文漏れ率: 5-8% (許容範囲外)
- エンドツーエンド遅延: 2-5秒 (ユーザー体験を損なう)
- 雑音混入率: 15-20% (会議環境で問題)

### 1.2 目的

音声翻訳の品質を総合的に向上させ、ユーザー満足度を高める。

### 1.3 対象ユーザー

- **主要**: ビジネス会議参加者（Teams/Zoom）
- **副次**: 日常会話ユーザー、セミナー参加者

### 1.4 対象言語ペア

| 優先度 | 言語ペア | 現状精度 | 目標精度 |
|--------|----------|----------|----------|
| 🔴 高 | zh ⇄ ja | 85% | 95% |
| 🔴 高 | ja ⇄ en | 88% | 95% |
| 🟡 中 | zh ⇄ vi | 80% | 90% |
| 🟡 中 | vi ⇄ en | 82% | 90% |

---

## 2. 基本方針

### 2.1 優先順位

```
最優先: 翻訳品質（正確度・自然度）
         ↓
次優先: リアルタイム性（体感遅延）
         ↓
最後: ノイズ低減
```

**判断基準**: トレードオフが発生した場合、この順序で判断する。

### 2.2 品質基準

**不可侵原則**:
- 語尾欠落を許容しない
- 意図誤解を許容しない
- 文を漏らさない（不能漏句子）

---

## 3. 機能要件

### FR-001: 言語別VAD最適化 🔴 必須

**要件**:
- 各言語の発話特性に応じたVADパラメータを設定可能にする

**詳細**:
- 日本語: 間が多い → 長め設定 (1.2s / 600ms)
- 英語: 標準 → 標準設定 (1.0s / 500ms)
- 中国語: やや速い → やや短め (0.9s / 450ms)
- ベトナム語: 非常に速い → 短め (0.8s / 400ms)

**受入基準**:
- [ ] 言語切替時に自動的にVADパラメータが変更される
- [ ] 各言語で文漏れ率が < 2% になる
- [ ] ユーザーが手動でパラメータを微調整できる

---

### FR-002: シナリオ別プリセット 🔴 必須

**要件**:
- 使用シーンに応じた設定プリセットを提供する

**詳細**:
- 会議モード: 精度優先（+30% 長め）
- 日常会話モード: バランス（標準）
- 短対話モード: 速度優先（-30% 短め）

**受入基準**:
- [ ] UIでモード切替ボタンを提供
- [ ] 各モードで期待通りの挙動をする
- [ ] モード切替が即座に反映される

---

### FR-003: 適応的VAD調整 🟡 重要

**要件**:
- ユーザーの発話パターンを学習し、VADパラメータを自動調整する

**詳細**:
- 直近10発話の平均時長・無音時長を記録
- 平均発話時長の70%を下限とする
- ±50%の範囲で微調整（最小/最大ガードレール付き）

**受入基準**:
- [ ] 5発話後に調整が開始される
- [ ] 過度な調整を防ぐガードレールが機能する
- [ ] オン/オフ切替が可能

---

### FR-004: 会話コンテキスト管理 🔴 必須

**要件**:
- 直近の会話履歴を参照し、翻訳の一貫性を保つ

**詳細**:
- 最大5発話を保持（5分以内）
- 固有名詞・専門用語を抽出して統一
- OpenAI API の instructions に注入

**受入基準**:
- [ ] 同一セッション内で術語が一貫する
- [ ] 代名詞が正しく解決される
- [ ] コンテキストによる遅延増加が < 100ms

---

### FR-005: 術語辞書管理 🟡 重要

**要件**:
- ユーザーがカスタム術語を登録・管理できる

**詳細**:
- UI: 術語追加フォーム（原語 → 訳語）
- ドメイン別辞書: IT、医療、ビジネス
- リアルタイム適用: API instructions に注入

**受入基準**:
- [ ] 術語追加が即座に反映される
- [ ] 登録した術語が100%一致する
- [ ] 最大500語まで登録可能

---

### FR-006: 音声バッファ検証 🔴 必須

**要件**:
- 無音・無効な音声データを送信しない

**詳細**:
- エネルギーレベルチェック（RMS > 0.001）
- ゼロサンプル比率チェック（< 95%）
- 最小長さチェック（≥ 200ms）

**受入基準**:
- [ ] 無音データが0%送信される
- [ ] API使用量が15%削減される
- [ ] ログに検証結果が記録される

---

### FR-007: タイムアウト・再送 🔴 必須

**要件**:
- API応答がない場合、自動的に再送する

**詳細**:
- タイムアウト: 30秒
- 最大再試行: 2回
- エクスポネンシャルバックオフ: 1s, 2s

**受入基準**:
- [ ] タイムアウト時に自動再送される
- [ ] 3回失敗後にエラー通知が表示される
- [ ] 再送中も次の発話を受け付ける

---

### FR-008: ストリーミング送信 🟡 重要

**要件**:
- 音声データを小分けにして即座に送信する

**詳細**:
- チャンクサイズ: 100ms (2400 samples @ 24kHz)
- 送信間隔: 100ms
- VAD連動: 音声検出時のみストリーミング

**受入基準**:
- [ ] 遅延が40%削減される
- [ ] 翻訳精度が維持される（A/Bテストで確認）
- [ ] ネットワーク使用量増加が許容範囲（+20%以内）

---

### FR-009: ノイズサプレッション 🟢 改善

**要件**:
- 背景雑音を除去して音声認識精度を向上させる

**詳細**:
- High-pass フィルタ: 80Hz（低周波ノイズ除去）
- Low-pass フィルタ: 8kHz（高周波ノイズ除去）
- Dynamics Compressor: 音量正規化

**受入基準**:
- [ ] SNRが10dB向上する
- [ ] 雑音環境でのCER劣化が+5pt以内
- [ ] 音質劣化が許容範囲（ユーザー評価）

---

### FR-010: エコーキャンセル 🟢 改善

**要件**:
- システム音声のループバックを検出・除去する

**詳細**:
- 適応フィルタによるエコー除去
- 遅延補償（最大500ms）
- システム音声モード時のみ有効

**受入基準**:
- [ ] エコー検出率が90%以上
- [ ] エコー除去率が70%以上
- [ ] 正常音声への影響が最小限

---

## 4. 非機能要件

### NFR-001: パフォーマンス 🔴 必須

| 指標 | 現状 | 目標 | 測定方法 |
|------|------|------|----------|
| CER (zh/ja) | 12-15% | **8-12%** | ゴールドコーパス |
| WER (vi/en) | 18-25% | **15-20%** | ゴールドコーパス |
| 訳抜け率 | 5-8% | **< 0.5%** | 人手評価 |
| 遅延 p50 | 2.5s | **≤ 1.2s** | タイムスタンプ |
| 遅延 p95 | 5.0s | **≤ 2.5s** | タイムスタンプ |

---

### NFR-002: 可用性 🔴 必須

- **稼働率**: 99.5% 以上
- **エラー率**: < 1%
- **再接続**: 自動（最大5回まで）
- **ロールバック**: 5分以内

---

### NFR-003: スケーラビリティ 🟡 重要

- **同時接続**: 1,000ユーザー以上
- **音声バッファ**: メモリ使用量 < 100MB / ユーザー
- **WebSocket接続**: プール管理（最大10接続）

---

### NFR-004: セキュリティ 🔴 必須

- **音声データ**: メモリのみ、ディスク保存なし
- **API キー**: 暗号化保存（AES-256-GCM）
- **通信**: TLS 1.3 以上
- **ログ**: 個人情報除外（匿名化）

---

### NFR-005: 保守性 🟡 重要

- **コードカバレッジ**: 80% 以上
- **ドキュメント**: 全モジュールにコメント
- **ログレベル**: DEBUG, INFO, WARN, ERROR
- **監視**: Grafana ダッシュボード

---

### NFR-006: 互換性 🔴 必須

- **ブラウザ**: Chrome 90+, Edge 90+, Firefox 88+
- **Electron**: 25.0.0 以上
- **Node.js**: 18.0.0 以上
- **OS**: Windows 10+, macOS 11+, Linux (Ubuntu 20.04+)

---

## 5. 制約事項

### 5.1 技術的制約

1. **OpenAI Realtime API**
   - 同時レスポンス: 1つのみ
   - 音声フォーマット: PCM16, 24kHz, モノラル
   - タイムアウト: 30秒

2. **Web Audio API**
   - AudioContext: 最大6個（ブラウザ制限）
   - AudioWorklet: Chrome 66+ 必須

3. **メモリ**
   - ブラウザ環境: 最大1GB
   - Electron環境: 最大2GB

---

### 5.2 運用制約

1. **API コスト**
   - 予算: 月額 $500 以内
   - 使用量監視: リアルタイム

2. **リリーススケジュール**
   - P0: 4週間以内
   - P1: 8週間以内
   - P2: 11週間以内

3. **サポート対応**
   - 営業時間: 平日 9:00-18:00 (JST)
   - 緊急対応: 24時間以内

---

### 5.3 法的制約

1. **プライバシー**
   - GDPR 準拠（EU ユーザー対象時）
   - 個人情報保護法 準拠（日本）

2. **ライセンス**
   - OpenAI API 利用規約 準拠
   - オープンソースライセンス 準拠

---

## 6. 成功基準

### 6.1 定量的成功基準

| No | 項目 | 現状 | 目標 | 達成判定 |
|----|------|------|------|----------|
| 1 | CER (zh/ja) | 12-15% | ≤ 12% | 12% 以下で達成 |
| 2 | 訳抜け率 | 5-8% | < 0.5% | 0.5% 未満で達成 |
| 3 | 遅延 p50 | 2.5s | ≤ 1.2s | 1.2s 以下で達成 |
| 4 | 遅延 p95 | 5.0s | ≤ 2.5s | 2.5s 以下で達成 |
| 5 | エラー率 | 3% | < 1% | 1% 未満で達成 |
| 6 | ユーザー満足度 | 3.5/5 | ≥ 4.5/5 | 4.5 以上で達成 |

**全体達成条件**: 6項目中5項目以上が達成基準を満たす

---

### 6.2 定性的成功基準

#### ユーザー評価

**アンケート項目**:
1. 翻訳の正確性に満足していますか？
2. 応答速度は快適ですか？
3. 音声品質（雑音・エコー）は許容範囲ですか？
4. 総合的に満足していますか？

**判定基準**: 各項目で「満足」以上が80%以上

#### 運用評価

1. **安定性**: 1週間以上の連続稼働が可能
2. **保守性**: 新規メンバーが1週間で保守可能
3. **拡張性**: 新言語ペア追加が1日以内に可能

---

### 6.3 検証方法

#### オフライン評価

1. **ゴールド音声コーパス**
   - 各言語対 × 各シーン: 50サンプル
   - 静音環境 + 雑音環境（SNR 0-15dB）

2. **バッチ評価**
   - 旧設定 vs 新設定で比較
   - CER/WER, COMET スコアを計算

#### オンライン評価

1. **A/B テスト**
   - 50% のユーザーに新設定を配信
   - 1-2週間でメトリクス比較

2. **ユーザーフィードバック**
   - アンケート実施（週次）
   - 誤訳報告の分析

---

## 7. リスクと対策

### 7.1 技術的リスク

| リスク | 影響 | 確率 | 対策 |
|--------|------|------|------|
| ストリーミングで精度低下 | 高 | 中 | A/Bテスト、ロールバック可能に |
| 適応VADが逆効果 | 中 | 低 | ガードレール、オン/オフ切替 |
| メモリリーク | 高 | 低 | 定期リソース解放、監視 |

### 7.2 運用リスク

| リスク | 影響 | 確率 | 対策 |
|--------|------|------|------|
| API コスト超過 | 中 | 低 | 使用量監視、アラート設定 |
| ユーザー学習コスト | 低 | 中 | チュートリアル、デフォルト最適化 |
| 後方互換性 | 中 | 低 | 段階的ロールアウト |

---

## 8. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトマネージャー | | | |
| 技術リード | | | |
| QA リード | | | |
| プロダクトオーナー | | | |

---

## 9. 改訂履歴

| バージョン | 日付 | 変更者 | 変更内容 |
|-----------|------|--------|----------|
| 1.0 | 2025-10-26 | AI アシスタント | 初版作成 |

---

**次のステップ**: [02_詳細設計書.md](./02_詳細設計書.md) で具体的な実装方法を定義する


