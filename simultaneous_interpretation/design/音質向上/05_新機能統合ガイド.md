# æ–°æ©Ÿèƒ½çµ±åˆã‚¬ã‚¤ãƒ‰ - éŸ³è³ªå‘ä¸Šãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

**æ–‡æ›¸ç•ªå·**: GUIDE-2025-002  
**ä½œæˆæ—¥**: 2025-10-26  
**æœ€çµ‚æ›´æ–°**: 2025-10-26  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**å‰ææ–‡æ›¸**: [02_è©³ç´°è¨­è¨ˆæ›¸.md](./02_è©³ç´°è¨­è¨ˆæ›¸.md), [03_ã‚¿ã‚¹ã‚¯ç®¡ç†è¡¨.md](./03_ã‚¿ã‚¹ã‚¯ç®¡ç†è¡¨.md)

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [WebSocket Keep-Alive](#websocket-keep-alive)
3. [DynamicsCompressoréŸ³é‡æ­£è¦åŒ–](#dynamicscompressoréŸ³é‡æ­£è¦åŒ–)
4. [VADé€£å‹•éŸ³å£°æµåˆ¶å¾¡](#vadé€£å‹•éŸ³å£°æµåˆ¶å¾¡)
5. [çµ±åˆä¾‹](#çµ±åˆä¾‹)
6. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## æ¦‚è¦

æœ¬ã‚¬ã‚¤ãƒ‰ã§ã¯ã€éŸ³è³ªå‘ä¸Šè¨ˆç”»ã§æ–°ãŸã«å®Ÿè£…ã•ã‚ŒãŸä»¥ä¸‹ã®æ©Ÿèƒ½ã®çµ±åˆæ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ï¼š

### æ–°æ©Ÿèƒ½ä¸€è¦§

| æ©Ÿèƒ½ | ç›®çš„ | å„ªå…ˆåº¦ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|------|--------|-----------|
| WebSocket Keep-Alive | æ¥ç¶šå®‰å®šæ€§å‘ä¸Š | é«˜ | âœ… å®Œäº† |
| DynamicsCompressor | éŸ³é‡æ­£è¦åŒ– | é«˜ | âœ… å®Œäº† |
| VADé€£å‹•éŸ³å£°æµåˆ¶å¾¡ | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§å‘ä¸Š | ä¸­ | ğŸ”„ çµ±åˆå¾…ã¡ |

---

## WebSocket Keep-Alive

### ç›®çš„

- WebSocketæ¥ç¶šã®ç”Ÿå­˜ç¢ºèª
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œå‡ºã¨è‡ªå‹•å†æ¥ç¶š
- é•·æ™‚é–“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å®‰å®šæ€§å‘ä¸Š

### ä»•æ§˜

- **å¿ƒè·³é–“éš”**: 30ç§’
- **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 90ç§’ï¼ˆ3å›é€£ç¶šã§pongæœªå—ä¿¡ï¼‰
- **å†æ¥ç¶š**: è‡ªå‹•ï¼ˆ3å›å¤±æ•—ã§åˆ‡æ–­ï¼‰

### å®Ÿè£…è©³ç´°

#### è‡ªå‹•èµ·å‹•

WebSocketManager ã¯æ¥ç¶šæˆåŠŸæ™‚ã«è‡ªå‹•çš„ã« Keep-Alive ã‚’é–‹å§‹ã—ã¾ã™ï¼š

```typescript
// src/core/WebSocketManager.ts

private handleOpen(): void {
    // ... æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ ...
    
    this.isConnected = true;
    console.info('[WebSocketManager] æ¥ç¶šæˆåŠŸ');

    // Keep-Aliveå¿ƒè·³ã‚’é–‹å§‹ï¼ˆè‡ªå‹•ï¼‰
    this.startKeepAlive();
}
```

#### Keep-Alive ãƒ¡ã‚«ãƒ‹ã‚ºãƒ 

```typescript
/**
 * Keep-Aliveå¿ƒè·³ã‚’é–‹å§‹
 * ç›®çš„: WebSocketæ¥ç¶šã®ç”Ÿå­˜ç¢ºèªã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ¤œå‡º
 * ä»•æ§˜: 30ç§’ã”ã¨ã«pingã‚’é€ä¿¡ã€3å›é€£ç¶šã§å¿œç­”ãªã—ã®å ´åˆã¯å†æ¥ç¶š
 */
private startKeepAlive(): void {
    this.stopKeepAlive(); // æ—¢å­˜ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢
    this.lastPongTime = Date.now();
    this.missedPongs = 0;

    // 30ç§’ã”ã¨ã«pingã‚’é€ä¿¡
    this.keepAliveInterval = setInterval(() => {
        if (!this.isConnected) {
            this.stopKeepAlive();
            return;
        }

        const now = Date.now();
        const timeSinceLastPong = now - this.lastPongTime;

        // 90ç§’ä»¥ä¸Šå¿œç­”ãŒãªã„å ´åˆï¼ˆ3å›é€£ç¶šã§pongæœªå—ä¿¡ï¼‰
        if (timeSinceLastPong > 90000) {
            defaultLogger.warn('[WebSocketManager] Keep-Alive timeout - å†æ¥ç¶šã‚’è©¦ã¿ã¾ã™');
            this.missedPongs++;

            if (this.missedPongs >= 3) {
                defaultLogger.error('[WebSocketManager] Keep-Aliveå¤±æ•— - æ¥ç¶šã‚’åˆ‡æ–­ã—ã¾ã™');
                this.disconnect();
                return;
            }
        }

        // pingãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        this.sendMessage({
            type: 'session.update',
            session: {} // ç©ºã®updateã§keep-aliveã¨ã—ã¦æ©Ÿèƒ½
        });
    }, 30000); // 30ç§’é–“éš”
}
```

#### Pongå¿œç­”ã®è¨˜éŒ²

```typescript
// session.updated ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡æ™‚ã«è‡ªå‹•çš„ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
private recordPong(): void {
    this.lastPongTime = Date.now();
    this.missedPongs = 0;
}
```

### ä½¿ç”¨æ–¹æ³•

**è¿½åŠ ã®è¨­å®šã¯ä¸è¦ã§ã™ã€‚** WebSocketManager ã‚’ä½¿ç”¨ã™ã‚‹ã ã‘ã§è‡ªå‹•çš„ã« Keep-Alive ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

```typescript
import { WebSocketManager } from './core/WebSocketManager';

const wsManager = new WebSocketManager();

// æ¥ç¶šã™ã‚‹ã ã‘ã§Keep-AliveãŒè‡ªå‹•èµ·å‹•
await wsManager.connect(apiKey);

// åˆ‡æ–­æ™‚ã«è‡ªå‹•åœæ­¢
await wsManager.disconnect();
```

### ç›£è¦–ã¨ãƒ‡ãƒãƒƒã‚°

ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã‚’æœ‰åŠ¹ã«ã™ã‚‹ã¨ã€Keep-Alive ã®å‹•ä½œã‚’ãƒ­ã‚°ã§ç¢ºèªã§ãã¾ã™ï¼š

```typescript
// src/core/Config.ts
export const CONFIG = {
    DEBUG_MODE: true, // ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹åŒ–
    // ...
};
```

ãƒ­ã‚°å‡ºåŠ›ä¾‹ï¼š

```
[WebSocketManager] Keep-Aliveé–‹å§‹ï¼ˆ30ç§’é–“éš”ï¼‰
[WebSocketManager] Keep-Alive pingé€ä¿¡
[WebSocketManager] Keep-Alive pongå—ä¿¡
[WebSocketManager] Keep-Alive timeout - å†æ¥ç¶šã‚’è©¦ã¿ã¾ã™
[WebSocketManager] Keep-Aliveå¤±æ•— - æ¥ç¶šã‚’åˆ‡æ–­ã—ã¾ã™
```

---

## DynamicsCompressoréŸ³é‡æ­£è¦åŒ–

### ç›®çš„

- éŸ³é‡ãƒ¬ãƒ™ãƒ«ã‚’ä¸€å®šã«ä¿ã¤
- éåº¦ãªéŸ³é‡å¤‰å‹•ã‚’æŠ‘åˆ¶
- å…¥åŠ›ã‚²ã‚¤ãƒ³ã®è‡ªå‹•èª¿æ•´

### ä»•æ§˜

- **Threshold**: -24 dB
- **Ratio**: 12:1
- **Attack**: 3ms
- **Release**: 250ms

### å®Ÿè£…è©³ç´°

#### NoiseSuppression ã‚¯ãƒ©ã‚¹ã®æ‹¡å¼µ

```typescript
// src/audio/NoiseSuppression.ts

export interface NoiseSuppressionConfig {
    highpassFreq: number;
    lowpassFreq: number;
    gain: number;
    enabled: boolean;
    // æ–°è¦è¿½åŠ 
    compressorEnabled: boolean;
    compressorThreshold: number;
    compressorRatio: number;
    compressorAttack: number;
    compressorRelease: number;
}
```

#### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š

```typescript
constructor(config?: Partial<NoiseSuppressionConfig>) {
    this.config = {
        highpassFreq: config?.highpassFreq ?? 100, // 100Hz
        lowpassFreq: config?.lowpassFreq ?? 8000, // 8kHz
        gain: config?.gain ?? 1,
        enabled: config?.enabled ?? true,
        // DynamicsCompressorè¨­å®šï¼ˆéŸ³è³ªå‘ä¸Šè¨ˆç”» ä»˜éŒ²Bæº–æ‹ ï¼‰
        compressorEnabled: config?.compressorEnabled ?? true,
        compressorThreshold: config?.compressorThreshold ?? -24, // -24dB
        compressorRatio: config?.compressorRatio ?? 12, // 12:1
        compressorAttack: config?.compressorAttack ?? 0.003, // 3ms
        compressorRelease: config?.compressorRelease ?? 0.25 // 250ms
    };
}
```

#### éŸ³å£°å‡¦ç†ãƒã‚§ãƒ¼ãƒ³

```typescript
// æ¥ç¶š: Source â†’ Highpass â†’ Lowpass â†’ [Compressor] â†’ Gain â†’ Destination

let currentNode: AudioNode = this.sourceNode;
currentNode = currentNode.connect(this.highpassFilter);
currentNode = currentNode.connect(this.lowpassFilter);

if (this.compressor) {
    currentNode = currentNode.connect(this.compressor);
}

currentNode.connect(this.gainNode).connect(this.destination);
```

### ä½¿ç”¨æ–¹æ³•

#### åŸºæœ¬çš„ãªä½¿ç”¨

```typescript
import { NoiseSuppression } from './audio/NoiseSuppression';

const noiseSuppression = new NoiseSuppression({
    compressorEnabled: true, // DynamicsCompressoræœ‰åŠ¹åŒ–
    compressorThreshold: -24,
    compressorRatio: 12,
    compressorAttack: 0.003,
    compressorRelease: 0.25
});

const processedStream = noiseSuppression.apply(inputStream, audioContext);
```

#### ã‚«ã‚¹ã‚¿ãƒ è¨­å®š

```typescript
// ä¼šè­°ã‚·ãƒ¼ãƒ³ç”¨ï¼ˆå¼·ã‚ã®åœ§ç¸®ï¼‰
const meetingConfig = new NoiseSuppression({
    compressorEnabled: true,
    compressorThreshold: -30, // ã‚ˆã‚Šä½ã„threshold
    compressorRatio: 16, // ã‚ˆã‚Šé«˜ã„ratio
    compressorAttack: 0.002,
    compressorRelease: 0.2
});

// æ—¥å¸¸ä¼šè©±ç”¨ï¼ˆæ¨™æº–ï¼‰
const dailyConfig = new NoiseSuppression({
    compressorEnabled: true,
    compressorThreshold: -24,
    compressorRatio: 12,
    compressorAttack: 0.003,
    compressorRelease: 0.25
});

// Compressorç„¡åŠ¹åŒ–
const noCompressorConfig = new NoiseSuppression({
    compressorEnabled: false
});
```

---

## ConversationContext + TerminologyManagerçµ±åˆ

### ç›®çš„

- ä¼šè©±å±¥æ­´ã‚’æ´»ç”¨ã—ãŸç¿»è¨³å“è³ªå‘ä¸Š
- è¡“èªã®ä¸€è²«æ€§ç¢ºä¿
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ãè‡ªç„¶ãªç¿»è¨³

### çµ±åˆæ–¹æ³•

#### WebSocketManager ã§ã®çµ±åˆä¾‹

```typescript
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã§ã®çµ±åˆ

import { WebSocketManager } from './core/WebSocketManager';
import { ConversationContext } from './context/ConversationContext';
import { TerminologyManager } from './context/TerminologyManager';

class TranslationApp {
    private wsManager: WebSocketManager;
    private conversationContext: ConversationContext;
    private terminologyManager: TerminologyManager;

    constructor() {
        this.wsManager = new WebSocketManager();

        // ConversationContextåˆæœŸåŒ–ï¼ˆæœ€å¤§10ã‚¨ãƒ³ãƒˆãƒªã€5åˆ†ä¿æŒï¼‰
        this.conversationContext = new ConversationContext({
            maxEntries: 10,
            maxAgeMs: 5 * 60 * 1000
        });

        // TerminologyManageråˆæœŸåŒ–
        this.terminologyManager = new TerminologyManager();
    }

    async initialize(apiKey: string, sourceLang: string, targetLang: string): Promise<void> {
        // ãƒ‰ãƒ¡ã‚¤ãƒ³åˆ¥è¡“èªè¾æ›¸ã‚’ãƒ­ãƒ¼ãƒ‰
        await this.terminologyManager.loadDomainDictionary('medical');

        // WebSocketæ¥ç¶š
        await this.wsManager.connect(apiKey);

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã‚’é€ä¿¡
        await this.updateSession(sourceLang, targetLang);

        // WebSocketã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
        this.setupWebSocketHandlers(sourceLang, targetLang);
    }

    /**
     * ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã‚’æ›´æ–°
     * ç›®çš„: ConversationContextã¨TerminologyManagerã®æƒ…å ±ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«åæ˜ 
     */
    private async updateSession(sourceLang: string, targetLang: string): Promise<void> {
        // TerminologyManagerã‹ã‚‰instructionsã‚’ç”Ÿæˆ
        const terminologyInstructions = this.terminologyManager.generateInstructions(
            sourceLang,
            targetLang
        );

        // ConversationContextã‹ã‚‰ä¼šè©±å±¥æ­´ã‚’å–å¾—
        const conversationHistory = this.conversationContext.getContext();

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã‚’æ§‹ç¯‰
        const sessionConfig = {
            sourceLang,
            targetLang,
            voiceType: 'alloy',
            audioOutputEnabled: true,
            vadEnabled: true,
            instructions: `${terminologyInstructions}\n\nä¼šè©±å±¥æ­´:\n${conversationHistory}`
        };

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³æ›´æ–°ã‚’é€ä¿¡
        await this.wsManager.updateSession(sessionConfig);
    }

    /**
     * WebSocketã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
     * ç›®çš„: WebSocketã‚¤ãƒ™ãƒ³ãƒˆã«åŸºã¥ãConversationContextã®æ›´æ–°
     */
    private setupWebSocketHandlers(sourceLang: string, targetLang: string): void {
        this.wsManager.setMessageHandlers({
            // å…¥åŠ›éŸ³å£°ã®è»¢å†™å®Œäº†æ™‚
            onInputTranscription: (transcript: string) => {
                // ConversationContextã«è¿½åŠ 
                this.conversationContext.addEntry({
                    role: 'user',
                    content: transcript,
                    lang: sourceLang,
                    timestamp: Date.now()
                });

                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ï¼ˆæ–°ã—ã„ä¼šè©±å±¥æ­´ã‚’åæ˜ ï¼‰
                this.updateSession(sourceLang, targetLang);
            },

            // ç¿»è¨³çµæœã®è»¢å†™å®Œäº†æ™‚
            onAudioTranscriptDone: (transcript: string) => {
                // ConversationContextã«è¿½åŠ 
                this.conversationContext.addEntry({
                    role: 'assistant',
                    content: transcript,
                    lang: targetLang,
                    timestamp: Date.now()
                });

                // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ï¼ˆæ–°ã—ã„ä¼šè©±å±¥æ­´ã‚’åæ˜ ï¼‰
                this.updateSession(sourceLang, targetLang);
            }
        });
    }

    /**
     * è¡“èªã‚’è¿½åŠ 
     */
    addTerminology(source: string, target: string, domain?: string): void {
        this.terminologyManager.addTerm(source, target, domain);

        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ›´æ–°ï¼ˆæ–°ã—ã„è¡“èªã‚’åæ˜ ï¼‰
        this.updateSession(this.sourceLang, this.targetLang);
    }
}
```

**å®Œå…¨ãªçµ±åˆä¾‹**: [FullIntegrationExample.ts](../../src/examples/FullIntegrationExample.ts) ã‚’å‚ç…§

---

## VADé€£å‹•éŸ³å£°æµåˆ¶å¾¡

### ç›®çš„

- VADæ¤œå‡ºã«åŸºã¥ãéŸ³å£°ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã®è‡ªå‹•åˆ¶å¾¡
- ç„¡éŸ³æ™‚ã®ä¸è¦ãªé€ä¿¡ã‚’å‰Šæ¸›
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§ã®å‘ä¸Š

### çµ±åˆæ–¹æ³•

#### AudioManager ã§ã®çµ±åˆä¾‹

```typescript
// src/core/AudioManager.ts

import { StreamingAudioSender } from '../audio/StreamingAudioSender';
import { VADProcessor } from '../audio/VADProcessor';

class AudioManager {
    private streamingSender: StreamingAudioSender;
    private vadProcessor: VADProcessor;

    constructor() {
        // StreamingAudioSenderåˆæœŸåŒ–
        this.streamingSender = new StreamingAudioSender({
            chunkSize: 4800, // 100ms @ 48kHz
            sendInterval: 100,
            debugMode: true
        });

        // VADProcessoråˆæœŸåŒ–
        this.vadProcessor = new VADProcessor({
            enabled: true,
            threshold: 0.5,
            minSpeechMs: 1000,
            silenceDelay: 500
        });

        // VADã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
        this.setupVADHandlers();
    }

    /**
     * VADã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
     */
    private setupVADHandlers(): void {
        // éŸ³å£°æ¤œå‡ºé–‹å§‹æ™‚
        this.vadProcessor.onSpeechStart = () => {
            console.info('[AudioManager] éŸ³å£°æ¤œå‡ºé–‹å§‹ - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°é–‹å§‹');
            this.streamingSender.start();
        };

        // éŸ³å£°æ¤œå‡ºçµ‚äº†æ™‚
        this.vadProcessor.onSpeechEnd = () => {
            console.info('[AudioManager] éŸ³å£°æ¤œå‡ºçµ‚äº† - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°åœæ­¢');
            
            // æœ€çµ‚ãƒãƒ£ãƒ³ã‚¯ã‚’é€ä¿¡
            this.streamingSender.flush();
            
            // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°åœæ­¢
            this.streamingSender.stop();
            
            // ãƒãƒƒãƒ•ã‚¡ã‚’ã‚³ãƒŸãƒƒãƒˆ
            this.wsManager.sendMessage({
                type: 'input_audio_buffer.commit'
            });
            
            // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
            this.wsManager.sendMessage({
                type: 'response.create'
            });
        };
    }
}
```

---

## çµ±åˆä¾‹

### å®Œå…¨ãªçµ±åˆä¾‹

```typescript
import { WebSocketManager } from './core/WebSocketManager';
import { NoiseSuppression } from './audio/NoiseSuppression';
import { StreamingAudioSender } from './audio/StreamingAudioSender';
import { VADProcessor } from './audio/VADProcessor';
import { getLanguageVADConfig } from './config/VADPresets';

class VoiceTranslateApp {
    private wsManager: WebSocketManager;
    private noiseSuppression: NoiseSuppression;
    private streamingSender: StreamingAudioSender;
    private vadProcessor: VADProcessor;

    async initialize(apiKey: string, sourceLang: string): Promise<void> {
        // 1. WebSocketæ¥ç¶šï¼ˆKeep-Aliveè‡ªå‹•èµ·å‹•ï¼‰
        this.wsManager = new WebSocketManager();
        await this.wsManager.connect(apiKey);

        // 2. è¨€èªåˆ¥VADè¨­å®šå–å¾—
        const vadConfig = getLanguageVADConfig(sourceLang);

        // 3. ãƒã‚¤ã‚ºã‚µãƒ—ãƒ¬ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–ï¼ˆDynamicsCompressoræœ‰åŠ¹ï¼‰
        this.noiseSuppression = new NoiseSuppression({
            compressorEnabled: true,
            compressorThreshold: -24,
            compressorRatio: 12,
            compressorAttack: 0.003,
            compressorRelease: 0.25
        });

        // 4. StreamingAudioSenderåˆæœŸåŒ–
        this.streamingSender = new StreamingAudioSender({
            chunkSize: 4800,
            sendInterval: 100,
            sendFunction: (chunk) => {
                this.wsManager.sendMessage({
                    type: 'input_audio_buffer.append',
                    audio: chunk
                });
            }
        });

        // 5. VADProcessoråˆæœŸåŒ–
        this.vadProcessor = new VADProcessor({
            enabled: true,
            threshold: vadConfig.threshold,
            minSpeechMs: vadConfig.minSpeechMs,
            silenceDelay: vadConfig.silenceDelay
        });

        // 6. VADé€£å‹•è¨­å®š
        this.vadProcessor.onSpeechStart = () => {
            this.streamingSender.start();
        };

        this.vadProcessor.onSpeechEnd = () => {
            this.streamingSender.flush();
            this.streamingSender.stop();
            this.wsManager.sendMessage({ type: 'input_audio_buffer.commit' });
            this.wsManager.sendMessage({ type: 'response.create' });
        };
    }
}
```

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Keep-Aliveé–¢é€£

**å•é¡Œ**: Keep-Alive timeout ãŒé »ç™ºã™ã‚‹

**åŸå› **: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸å®‰å®šã€ã‚µãƒ¼ãƒãƒ¼å¿œç­”é…å»¶

**è§£æ±ºç­–**:
```typescript
// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶é•·ï¼ˆ90ç§’ â†’ 120ç§’ï¼‰
// src/core/WebSocketManager.ts ã® startKeepAlive() å†…
if (timeSinceLastPong > 120000) { // 120ç§’ã«å¤‰æ›´
    // ...
}
```

### DynamicsCompressoré–¢é€£

**å•é¡Œ**: éŸ³å£°ãŒæ­ªã‚€ã€ä¸è‡ªç„¶ã«èã“ãˆã‚‹

**åŸå› **: Compressorè¨­å®šãŒå¼·ã™ãã‚‹

**è§£æ±ºç­–**:
```typescript
// ã‚ˆã‚Šç·©ã‚„ã‹ãªè¨­å®šã«å¤‰æ›´
const noiseSuppression = new NoiseSuppression({
    compressorThreshold: -18, // -24 â†’ -18
    compressorRatio: 8, // 12 â†’ 8
    compressorAttack: 0.005, // 3ms â†’ 5ms
    compressorRelease: 0.3 // 250ms â†’ 300ms
});
```

### VADé€£å‹•é–¢é€£

**å•é¡Œ**: éŸ³å£°ãŒé€”åˆ‡ã‚Œã‚‹

**åŸå› **: VADé–¾å€¤ãŒé«˜ã™ãã‚‹ã€silenceDelayãŒçŸ­ã™ãã‚‹

**è§£æ±ºç­–**:
```typescript
// VADè¨­å®šã‚’ç·©å’Œ
const vadProcessor = new VADProcessor({
    threshold: 0.3, // 0.5 â†’ 0.3ï¼ˆã‚ˆã‚Šæ•æ„Ÿã«ï¼‰
    silenceDelay: 800 // 500ms â†’ 800msï¼ˆã‚ˆã‚Šé•·ãå¾…ã¤ï¼‰
});
```

---

## ã¾ã¨ã‚

æœ¬ã‚¬ã‚¤ãƒ‰ã§èª¬æ˜ã—ãŸ3ã¤ã®æ–°æ©Ÿèƒ½ã¯ã€éŸ³è³ªå‘ä¸Šè¨ˆç”»ã®æ ¸å¿ƒéƒ¨åˆ†ã§ã™ï¼š

1. **WebSocket Keep-Alive**: è‡ªå‹•èµ·å‹•ã€è¿½åŠ è¨­å®šä¸è¦
2. **DynamicsCompressor**: NoiseSuppression ã«çµ±åˆã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹
3. **VADé€£å‹•éŸ³å£°æµåˆ¶å¾¡**: AudioManager ã§çµ±åˆæ¨å¥¨

ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®æ”¹å–„ãŒæœŸå¾…ã§ãã¾ã™ï¼š

- æ¥ç¶šå®‰å®šæ€§: 30%å‘ä¸Š
- éŸ³é‡ä¸€è²«æ€§: 50%å‘ä¸Š
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ€§: é…å»¶20%å‰Šæ¸›

æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—: [06_ãƒ†ã‚¹ãƒˆè¨ˆç”»æ›¸.md](./06_ãƒ†ã‚¹ãƒˆè¨ˆç”»æ›¸.md) ã‚’å‚ç…§ã—ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

