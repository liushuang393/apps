# 音質向上計画（VoiceTranslate Pro 2.0）

最終更新: 2025-10-26

---

## 0. 方針（優先順位）
- 翻訳品質（正確度・自然度）を最優先：語尾欠落・意図誤解を許容しない。
- 次にリアルタイム性（端末体感遅延）：不要な待機を極小化する。
- 最後にノイズ低減：品質を損なう過度な抑圧は避ける。

この優先順位は、相互にトレードオフがある施策間の判断基準とする。

---

## 1. 現状と課題（要確認）
以下は現場ヒアリングで確定する前提の仮設リストです。
- 発話が頻繁に細切れになる（短すぎる分段）
- 端末・環境差による入力レベル不安定（AGC不足/過剰）
- 背景雑音・反響が文字化（ノイズ/エコー耐性不足）
- 用語ゆらぎにより訳語が一定しない（用語統制/同義正規化不足）
- 端末体感遅延が大きい（送信/確定戦略の最適化不足）

---

## 2. 目標とKPI（測定定義込み）
- 正確度（ASR）
  - 指標: CER/WER（言語依存、漢字圏はCER中心）
  - 目標: CER ≤ 8–12%（zh/ja）, WER ≤ 15–20%（vi 等）
  - 測定: 代表ドメインのゴールド音声コーパスでバッチ評価
- 翻訳品質（自然度/忠実度）
  - 指標: COMET または MQM（人手評価併用）
  - 目標: COMET ≥ 0.55 相当（ドメイン依存で調整）
  - 測定: 並列コーパス＋現場メモで定期評価
- 端から端までの遅延（E2E）
  - 指標: 音声開始→訳文音声/文字可視までの時間
  - 目標: p50 ≤ 1.2s / p95 ≤ 2.5s（会議用途）
  - 測定: タイムスタンプ計測（入力→ASR→翻訳→TTS/表示）
- 安定性
  - 指標: 不両立事象（語尾欠落率、重複/飛び、分段過多率）
  - 目標: 欠落率 ≤ 0.5%、平均セグメント長 ≥ 1.2s、分段過多率 ≤ 10%
  - 測定: ストリームログ解析 + 自動ヒューリスティック
- 可読性
  - 指標: 句読点適合率、文整形F1、用語一致率
  - 目標: 用語一致率 ≥ 95%、読点/句点適合F1 ≥ 0.9
  - 測定: 後処理器の差分テスト + 用語辞書適用可否
- 耐性（ノイズ/エコー/重なり）
  - 指標: SNR 0–15dB でのCER/WER/欠落率の劣化幅
  - 目標: 低SNR時でも CER 劣化 +5pt 以内、欠落率 +0.5pt 以内

---

## 3. 優先事項（選択して下さい）
- 最優先2項目（チェックを2つ）
  - [x] 正確度（ASR）
  - [ ] 自然度（翻訳）
  - [x] 遅延（リアルタイム性）
  - [ ] 安定性（不落、不細切れ）

---

## 4. 対象言語ペアとシーン（選択/追記）
- 言語ペア
  - [x] zh ↔ ja
  - [x] ja ↔ zh
  - [x] zh ↔ vi
  - [x] vi ↔ zh
  - [x] ja ↔ vi
  - [ ] その他: __________
- シーン
  - [x] 会議（複数話者/遠距離マイク）
  - [x] 日常会話（近距離/モバイル）
  - [x] セミナー/講義（長尺）
  - [ ] コールセンター/接客
  - [ ] その他: __________

---

## 5. 改善ポリシーと主要施策

### 5.1 分段（VAD/セグメンター）
- 最短発話長 1.0s + 無音確認 0.5s（ヒステリシスを持たせて過分割を防止）
- オーバーラップ文脈 120ms を次セグメントに付与（語尾切れ防止）
- ロング・ブリージング対応: 連続発話中は最大 6–8s でソフト切り（ASR確定のため）
- 言語別/シナリオ別プリセット（計画2の示唆を反映）
  - 例: ja=1.2s/600ms, zh=0.9s/450ms, vi=0.8s/400ms
  - シナリオ: 会議=+30%/20%、日常=標準、短対話=-30%/-20%
- 適応的閾値調整（直近履歴ベース・上限/下限付き）
  - 直近発話の平均長/無音長に基づき ±50% 範囲で微調整
  - 最小下限: 基準値の50%／平均発話長の70%

### 5.2 送信戦略（ストリーミング）
- 100ms チャンクで上り送信（Nagle 無効化相当、即時Flush）
- ASR一時確定（partial）と最終確定（final）の両方を翻訳側に配信
- 終話判定後ただちに最終フラッシュ（確定遅延を抑制）
- VAD連動でストリーミングON/OFFを制御し、commit タイミングを明確化
- WebSocket Keep-Alive と送受の並列化（収集と送信を非同期に）
- 音声バッファの無音検証とタイムアウト・再送のポリシー（誤送信/停止を防止）

### 5.3 ノイズ/エコー/入力レベル
- ノイズ抑制（NS）/エコーキャンセル（AEC）/自動利得制御（AGC）を有効
- 入力ゲイン事前較正（-18〜-12 LUFS 目安）、過剰AGCのポンピングを回避
- ダブル・トーク（重なり話者）時の誤起動を最小化（VAD感度緩和 + 再確認）

### 5.4 可読性（後処理）
- 句読点・文整形の後処理器を強化（言語ペア別ルール/モデル）
- 用語辞書・同義正規化（例: フリガナ/表記ゆれ統一、専門用語固定訳）
- 過度な逐語訳を抑え、意味保全を優先するパラメータに調整
- 会話コンテキスト注入（直近3–5発話＋簡易用語抽出）を instructions に同梱し、一貫性/代名詞解決を補助

### 5.5 モデル/パラメータ構成
- Realtime API: gpt-realtime-2025-08-28（音声ストリーミング）
- 翻訳/後処理: gpt-4o または gpt-5-2025-08-07（ドメイン文体指示）
- 言語ペア別に VAD 閾値、句読点器、用語辞書を切替

---

## 6. 段階的実施計画（P0→P2）

### P0（1〜3日）: 即効性
- 分段: 最短1.0s + 無音0.5s、オーバーラップ120ms
- 送信: 100ms チャンク送信 + partial/final 並行配信
- ノイズ: NS/AEC/AGC 有効化 + 入力ゲインガイド
- 可読性: 句読点・断句後処理ON、用語辞書の初版投入
- 計測: 主要メトリクスのログ出力（タイムスタンプ/確定回数/欠落検出）

### P1（1〜2週）: 最適化
- 分段の動的適応（話速/雑音に応じて閾値チューニング）
- 並列化/パイプライン深度最適化（ASR→MT→TTS の重なり度合い調整）
- 用語辞書の拡充（現場フイードバックから週次更新）
- 翻訳プロンプト/パラメータ最適化（文体、要約/逐次切替）

### P2（2〜4週）: 堅牢化
- 雑音・エコー・重なり音声ベンチ（SNR 0–15dB）で耐性チューニング
- モデル/モード切替の自動化（静音/雑音/会議モード）
- 再発防止: 可観測性ダッシュボード（p50/p95、欠落率、分段分布）

---

## 7. 検証計画（計測・評価）
- オフライン評価: 代表音声コーパス（発話・雑音別）で ASR/翻訳を一括採点
- オンライン計測: 実運用ログから p50/p95 遅延、欠落率、分段分布を抽出
- A/B: 旧設定 vs 新設定で同一セッション比較（同時刻/同席でのペア）
- 人手評価: MQM（誤訳/過訳/訳抜け/用語逸脱）観点の週次レビュー

---

## 8. 既知のトレードオフと対処
- 分段を長く→欠落減・自然度↑、だが遅延↑：ヒステリシス + オーバーラップで緩和
- ノイズ抑制を強く→誤認識↓、だが歪み↑：入力ゲイン/NSレベルの共同最適化
- 句読点強化→可読性↑、だが確定遅延↑：partial段階では軽量整形、finalで強整形

---

## 9. ロールアウトとリスク管理
- フェーズド配布（内部→小規模→本番幅広）
- フィードバック窓口（用語追加、誤訳報告、雑音事例）
- ロールバック手順（設定差し替えで即時復旧可能に）

---

## 付録A: 推奨デフォルト値（初期）
- 分段: 最短 1000ms / 無音 500ms / オーバーラップ 120ms / 最大発話 8s
- 送信: 100ms チャンク、partial即時、final終話直後
- 入力: 16kHz/16bit PCM 推奨、入力ゲイン -18〜-12 LUFS
- 後処理: 句読点ON、文整形ON、用語辞書（初版）ON
- モデル: Realtime API gpt-realtime-2025-08-28 + 翻訳 gpt-4o or gpt-5-2025-08-07

---

## 10. 実装ロードマップ（抜粋）
- フェーズ1（W1–W4）: P0-1 言語別VAD/シナリオプリセット → P0-2 会話コンテキスト注入 → P0-3 音声検証/再送 → 統合計測
- フェーズ2（W5–W8）: P1-1 ストリーミング送信/並列化 → P1-2 術語辞書UI → P1-3 プリロード最適化 → ベンチ
- フェーズ3（W9–W11）: P2-1 ノイズサプレッション → P2-2 エコーキャンセル → 品質最終評価

---

## 11. リスク評価（要約）
- 技術: ストリーミングで精度低下（事前A/Bで判定、ロールバック可能に）
- 技術: 適応VADが逆効果（ガードレール: ±50%/最小値、オフ切替）
- 技術: ノイズ処理で歪み（パラメータ調整とON/OFF設定）
- 運用: APIコスト増（使用量監視/オプション化）、ユーザー学習コスト（チュートリアル）

---

## 付録B: 推奨WebAudio前処理パラメータ（参考）
- High-pass: 80 Hz（Q=0.7） / Low-pass: 8 kHz（Q=0.7）
- Compressor: threshold -24 dB / ratio 12:1 / attack 3ms / release 250ms
- 入力ゲイン: +20% 目安（最大発話で0 dBFSに近づけない）

---

本計画は「翻訳品質 > リアルタイム性 > ノイズ低減」を原則とし、漏句ゼロと意味保全を最優先に進めます。
必要に応じて言語ペア別のパラメータセットを分岐し、A/B とログ計測により安全にロールアウトします。

