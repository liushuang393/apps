# クイックテストガイド - バグ修正検証

**バージョン**: 2.0.1  
**テスト対象**: 並発制御とタイムアウト修正

---

## 🎯 テスト目的

以下の問題が修正されたことを確認:
1. ✅ 翻訳の完全性（途中で切れない）
2. ✅ 並発エラーの解消
3. ✅ タイムアウトの改善

---

## 🚀 クイックテスト（5分）

### 準備

1. **ブラウザを開く**
   ```
   Chrome または Edge を推奨
   ```

2. **拡張機能をリロード**
   ```
   chrome://extensions/ → VoiceTranslate Pro → 🔄 リロード
   ```

3. **コンソールを開く**
   ```
   F12 → Console タブ
   ```

---

### テスト 1: 基本翻訳（2分）

#### 手順

1. **接続**
   - 「接続」ボタンをクリック
   - ステータス: 「接続済み」を確認

2. **短い文章**
   - 「録音開始」をクリック
   - 「こんにちは」と話す
   - 「録音停止」をクリック
   - **期待結果**: "Hello" と翻訳される

3. **長い文章**
   - 「録音開始」をクリック
   - 「今日はとても良い天気ですね。散歩に行きたいです。」と話す
   - 「録音停止」をクリック
   - **期待結果**: 完全な文章が翻訳される

#### 確認ポイント

✅ 文章が途中で切れていない  
✅ エラーログが出ていない  
✅ 翻訳が完全に表示される

---

### テスト 2: Server VAD（2分）

#### 手順

1. **Server VAD を有効化**
   - 詳細設定 → 「Server VAD」をON

2. **連続発話**
   - 「録音開始」をクリック
   - 「こんにちは」と話す
   - **1秒待つ**
   - 「今日は良い天気です」と話す
   - **1秒待つ**
   - 「録音停止」をクリック

3. **コンソールログを確認**
   ```
   [Audio] 音声バッファコミット完了
   [🔊 Response Create] 要求
   [Response] Created: resp_XXX
   [Response] Complete: resp_XXX
   ```

#### 確認ポイント

✅ 各発話が個別に翻訳される  
✅ 並発エラーが出ない  
✅ 「重複コミットを検出」ログが出る（正常）

---

### テスト 3: 並発制御（1分）

#### 手順

1. **連続クリック**
   - 「録音開始」をクリック
   - すぐに「録音停止」をクリック
   - すぐに「録音開始」をクリック
   - すぐに「録音停止」をクリック
   - **3回繰り返す**

2. **コンソールログを確認**
   ```
   [Audio] 前のレスポンスが処理中のため、スキップします
   ```

#### 確認ポイント

✅ エラーが出ない  
✅ システムがクラッシュしない  
✅ 並発制御ログが出る（正常）

---

## 📊 詳細テスト（15分）

### テスト 4: 長時間使用

#### 手順

1. **10回連続翻訳**
   - 「録音開始」→ 発話 → 「録音停止」を10回繰り返す
   - 各回で異なる文章を話す

2. **メモリ使用量を確認**
   - F12 → Performance → Memory
   - メモリリークがないことを確認

#### 期待結果

✅ すべての翻訳が成功  
✅ メモリ使用量が安定  
✅ エラーが出ない

---

### テスト 5: エッジケース

#### 5.1 非常に長い文章

```
「今日は本当に素晴らしい天気ですね。
朝から青空が広がっていて、
気温も程よく暖かくて、
散歩に出かけるには最高の日和です。
公園に行って、
ベンチに座って、
本でも読みたいですね。」
```

**期待結果**: 完全に翻訳される

#### 5.2 短い間隔での発話

```
「こんにちは」（0.5秒待つ）
「元気ですか」（0.5秒待つ）
「今日は良い天気です」
```

**期待結果**: 各発話が個別に翻訳される

#### 5.3 無音

```
録音開始 → 5秒無音 → 録音停止
```

**期待結果**: エラーが出ない、または適切なメッセージ

---

## 🐛 トラブルシューティング

### 問題 1: 翻訳が途中で切れる

**症状**:
```
入力: 「今日はとても良い天気ですね」
出力: "Today is very" （途中で切れる）
```

**確認**:
1. コンソールで `silence_duration_ms` を確認
   ```javascript
   // 1200 になっているか確認
   ```

2. 修正が適用されているか確認
   ```
   voicetranslate-pro.js の行996を確認
   ```

**解決策**:
- 拡張機能をリロード
- ページをリフレッシュ

---

### 問題 2: 並発エラーが出る

**症状**:
```
[Error] conversation_already_has_active_response
```

**確認**:
1. コンソールで並発制御ログを確認
   ```
   [Audio] 前のレスポンスが処理中のため、スキップします
   ```

2. `activeResponseId` が正しく管理されているか確認

**解決策**:
- 接続を切断して再接続
- ページをリフレッシュ

---

### 問題 3: 翻訳が遅い

**症状**:
- 録音停止から翻訳まで3秒以上かかる

**確認**:
1. ネットワーク速度を確認
2. API キーが正しいか確認
3. Server VAD の設定を確認

**解決策**:
- Server VAD を無効にしてテスト
- `silence_duration_ms` を短くする（1000ms）

---

## ✅ テスト結果チェックリスト

### 基本機能
- [ ] 短い文章の翻訳が成功
- [ ] 長い文章の翻訳が成功
- [ ] 翻訳が途中で切れない
- [ ] エラーログが出ない

### Server VAD
- [ ] Server VAD が正常動作
- [ ] 連続発話が個別に翻訳される
- [ ] 並発エラーが出ない

### 並発制御
- [ ] 連続クリックでエラーが出ない
- [ ] 重複コミットが防止される
- [ ] システムが安定動作

### 長時間使用
- [ ] 10回連続翻訳が成功
- [ ] メモリリークがない
- [ ] パフォーマンスが安定

---

## 📝 テスト報告テンプレート

```markdown
## テスト結果

**日時**: 2025-XX-XX XX:XX
**環境**: Chrome/Edge XX.X
**バージョン**: 2.0.1

### 基本機能
- 短い文章: ✅/❌
- 長い文章: ✅/❌
- 完全性: ✅/❌

### Server VAD
- 動作: ✅/❌
- 並発制御: ✅/❌

### 問題
- なし / 以下の問題あり:
  - 問題1: ...
  - 問題2: ...

### コメント
- ...
```

---

## 🎓 デバッグのヒント

### 有用なコンソールコマンド

```javascript
// 現在の設定を確認
console.log('Active Response ID:', app.activeResponseId);
console.log('Last Commit Time:', app.lastCommitTime);
console.log('Queue Status:', app.responseQueue.getStatus());

// 統計情報を確認
console.log('Stats:', app.responseQueue.getStats());
```

### ログの見方

**正常なログ**:
```
[Audio] 音声バッファコミット完了
[🔊 Response Create] 要求
[Response] Created: resp_XXX
[Response] Complete: resp_XXX
```

**並発制御が働いているログ（正常）**:
```
[Audio] 重複コミットを検出、スキップします
[Audio] 前のレスポンスが処理中のため、スキップします
```

**エラーログ（要調査）**:
```
[Error] conversation_already_has_active_response
[ResponseQueue] エラー: ...
```

---

## 📞 サポート

テストで問題が見つかった場合:

1. **コンソールログをコピー**
2. **再現手順を記録**
3. **スクリーンショットを撮影**
4. **報告**

---

**Happy Testing!** 🎉

**VoiceTranslate Pro Team**  
**Version 2.0.1**

