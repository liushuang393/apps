#!/bin/bash
# ===============================================
# VoiceTranslate Pro - 環境変数付き起動スクリプト
# ===============================================
#
# 使用方法:
#   1. このファイルを start-with-env.sh にコピー
#   2. 下記のAPIキーを実際のキーに置き換え
#   3. chmod +x start-with-env.sh で実行権限を付与
#   4. ./start-with-env.sh で起動
#
# 注意:
#   - start-with-env.sh を .gitignore に追加してください
#   - APIキーは絶対にGitリポジトリにコミットしないでください
#
# ===============================================

echo "==============================================="
echo "VoiceTranslate Pro - Electron起動（環境変数設定）"
echo "==============================================="
echo ""

# OpenAI APIキーを環境変数に設定
# ⚠️ 下記の YOUR_API_KEY_HERE を実際のAPIキーに置き換えてください
export OPENAI_API_KEY="sk-proj-YOUR_API_KEY_HERE"

# APIキーが設定されているか確認
if [ "$OPENAI_API_KEY" = "sk-proj-YOUR_API_KEY_HERE" ]; then
    echo "[エラー] APIキーが設定されていません"
    echo ""
    echo "手順:"
    echo "  1. このファイルをテキストエディタで開く"
    echo "  2. \"sk-proj-YOUR_API_KEY_HERE\" を実際のAPIキーに置き換える"
    echo "  3. ファイルを保存して再度実行"
    echo ""
    exit 1
fi

# カレントディレクトリをスクリプトの場所に移動
cd "$(dirname "$0")"

echo "APIキー設定: ${OPENAI_API_KEY:0:10}..."
echo ""

# Node.js確認
if ! command -v node &> /dev/null; then
    echo "[エラー] Node.jsが見つかりません"
    echo "Node.jsをインストールしてください: https://nodejs.org/"
    exit 1
fi

# 依存関係確認
if [ ! -d "node_modules" ]; then
    echo "[警告] node_modulesが見つかりません"
    echo "npm installを実行します..."
    npm install
    if [ $? -ne 0 ]; then
        echo "[エラー] npm install失敗"
        exit 1
    fi
fi

# Electronアプリを起動
echo "Electronアプリを起動中..."
echo ""
npm run electron

if [ $? -ne 0 ]; then
    echo ""
    echo "[エラー] Electron起動失敗"
    exit 1
fi

echo ""
echo "==============================================="
echo "Electronアプリを終了しました"
echo "==============================================="

