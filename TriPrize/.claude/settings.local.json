{
  "permissions": {
    "allow": [
      "Bash(git fetch:*)",
      "Bash(if [ -d specs ])",
      "Bash(then ls -d specs/*-triangle-lottery)",
      "Bash(else echo 'No specs directory')",
      "Bash(fi)",
      "Bash(powershell.exe:*)",
      "SlashCommand(/speckit.plan 本計画は **Vite** を採用し、**外部ライブラリ最小**・**オフライン前提**で構築する。**サーバー情報（エンドポイント、資格情報、API キー等）はすべてローカル SQLite に保存**し、**ネットワークへ送信しない**。画像は外部アップロード不可、メタデータもローカル保存のみ。\n\n**目的**\n\n* 単純・軽量・依存最小のフロントエンド。\n* サーバー接続に必要な**機微情報をローカル DB で安全管理**（復号はメモリ上のみ）。\n\n**技術方針**\n\n* ビルド/開発：Vite（ESM/HMR）、素の **HTML・CSS・JavaScript** を基本。\n* データ永続化：SQLite（ローカルファイル）。暗号化は **SQLCipher もしくは SQLite 用ページ暗号化拡張**を推奨。\n* 秘密鍵管理：\n\n  * 可能なら OS の安全保管庫（macOS Keychain／Windows DPAPI／Linux Secret Service）に**DB 暗号鍵**を格納。\n  * 代替として**ユーザー設定のパスフレーズ**→ **Argon2/PBKDF2** で鍵導出。\n* 画像取扱い：ローカル参照のみ（EXIF などのメタデータも DB に保存、外部送信禁止）。\n\n**スキーマ（最小例）**\n\n* `servers(id, name, base_url, note, created_at, updated_at)`\n* `credentials(id, server_id, user, enc_secret, enc_type, rotated_at)`  // API キーやトークンを**暗号化**して保存\n* `settings(id, k, v, updated_at)`\n* `images(id, file_path, file_hash, exif_json, created_at)`\n  インデックス：`servers(base_url)`、`credentials(server_id)`、`images(file_hash)`。\n\n**セキュリティ運用**\n\n* 復号は**使用直前のみ**。ログ・コンソールに秘密値を出力しない。\n* クリップボードコピーは明示操作時のみ（自動コピー禁止）。\n* 鍵ローテーション：`enc_secret` を再暗号化可能にし、**定期/手動ローテーション**対応。\n* アイデルック（一定時間無操作）で**自動ロック**→再解錠にパスフレーズ/OS キーチェーンを要求。\n* 監査（ローカル）：`settings` にハッシュ（変更検出用）を保持。外部送信は行わない。\n\n**ネットワーク方針**\n\n* 既定は**完全オフライン**。\n* 明示操作でのみ HTTP を実行し、**送信するのは API リクエストに必要な最小項目のみ**。\n* テレメトリ/解析/クラッシュ送信は**無効**。\n\n**バックアップ/移行**\n\n* エクスポート：**暗号化済み SQLite** もしくは **パスワード保護 ZIP**。\n* インポート：同一スキーマとバージョンを検証。\n* マイグレーション：`settings.schema_version` を持ち、起動時に段階適用（ロールフォワード）。\n\n**品質/テスト**\n\n* Lint/Format：ESLint・Prettier 最小設定。\n* テスト：\n\n  * 単体：暗号化/復号、鍵導出、ロック/解除、ローテーション。\n  * 結合：サーバー登録→資格情報保存→復号して API 呼び出し（モック）→ロック→再解錠。\n* 受入基準（抜粋）：\n\n  * **サーバー情報と資格情報が常にローカル SQLite にのみ保存**され、外部送信されない。\n  * 暗号鍵が OS 保管庫またはパスフレーズで安全に管理される。\n  * ロック/解除・バックアップ/復元が再現可能に動作する。\n\n**禁止事項 / 制約**\n\n* サーバー情報・資格情報・画像メタの**外部アップロード禁止**。\n* 不要な状態管理/UI フレームワークの導入禁止。\n* .env に本番秘密情報を保存しない（開発サンプル値のみ）。)",
      "Bash(if [ -f \"D:\\apps\\specs\\001-triangle-lottery\\plan.md\" ])",
      "Bash(then echo \"File exists\")",
      "Bash(else echo \"File does not exist\")",
      "WebSearch",
      "WebFetch(domain:docs.stripe.com)",
      "Bash(dir:*)",
      "Bash(flutter analyze:*)",
      "Bash(docker-compose ps:*)",
      "Bash(npm run migrate:*)",
      "Bash(npm run dev:*)",
      "Bash(flutter devices:*)",
      "Bash(flutter run:*)",
      "Bash(curl:*)",
      "Bash(nc:*)",
      "Bash(taskkill:*)",
      "Bash(NUL)",
      "Bash(timeout 90 bash:*)",
      "Bash(npm run db:shell:*)",
      "Bash(docker exec:*)",
      "Bash(npx ts-node:*)",
      "Bash(flutter pub run build_runner build:*)",
      "Bash(flutter test:*)",
      "Bash(cat:*)",
      "Bash(flutter clean:*)",
      "Bash(timeout 40 bash:*)",
      "Bash(timeout 60 bash:*)",
      "Bash(npx tsc:*)",
      "Bash(timeout 5 bash:*)",
      "Bash(netstat:*)",
      "Bash(findstr:*)",
      "Bash(timeout 3 bash:*)",
      "Bash(timeout 30 bash:*)"
    ],
    "deny": [],
    "ask": []
  }
}
